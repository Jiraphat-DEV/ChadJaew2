# MediaMTX Configuration for Telescope Camera
# Low-latency WebRTC streaming

# Logging
logLevel: warn
logDestinations: [stdout]

# API (for health checks)
api: yes
apiAddress: 127.0.0.1:9997

# WebRTC - Primary streaming protocol
webrtc: yes
webrtcAddress: :8889
webrtcAllowOrigins: ['*']
webrtcICEServers2: []

# RTSP - Used internally for capture
rtsp: yes
rtspAddress: :8554

# Low latency settings
readBufferCount: 512
writeQueueSize: 512

# Disable unused protocols
hls: no
srt: no
rtmp: no

# Stream paths
paths:
  telescope:
    runOnInit: >
      ffmpeg -f v4l2 -input_format mjpeg
      -video_size 640x480 -framerate 30
      -fflags nobuffer+discardcorrupt+flush_packets -flags low_delay
      -thread_queue_size 64 -probesize 32 -analyzeduration 0
      -i /dev/video0
      -pix_fmt yuv420p
      -c:v h264_v4l2m2m
      -b:v 1500k
      -g 10 -keyint_min 10
      -bf 0
      -f rtsp rtsp://localhost:$RTSP_PORT/$MTX_PATH
    runOnInitRestart: yes
